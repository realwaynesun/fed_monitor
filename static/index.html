<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wayne's Macro Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        :root {
            --bg-primary: #0e1117;
            --bg-secondary: #1a1d24;
            --bg-card: #262730;
            --text-primary: #fafafa;
            --text-secondary: #a0a0a0;
            --accent-cyan: #00d4ff;
            --accent-coral: #ff6b6b;
            --accent-teal: #4ecdc4;
            --accent-yellow: #ffe66d;
            --border-color: #333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        header .meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .alerts-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .alert-box {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }

        .alert-box.critical { border-color: #ff4444; }
        .alert-box.warning { border-color: #ffaa00; }
        .alert-box.info { border-color: #00aaff; }

        .alert-box h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .alert-box.critical h3 { color: #ff4444; }
        .alert-box.warning h3 { color: #ffaa00; }
        .alert-box.info h3 { color: #00aaff; }

        .alert-count {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .alert-item {
            font-size: 0.85rem;
            padding: 8px 0;
            border-top: 1px solid var(--border-color);
        }

        .alert-item strong {
            color: var(--accent-cyan);
        }

        .chart-container {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-container {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .table-container h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            font-family: 'SF Mono', Monaco, monospace;
        }

        tr:hover {
            background: rgba(255,255,255,0.03);
        }

        .positive { color: #4ecdc4; }
        .negative { color: #ff6b6b; }

        footer {
            margin-top: 50px;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }

        /* Key Metrics Summary Panel */
        .key-metrics-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .key-metric {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .key-metric .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .key-metric .value {
            font-size: 1.4rem;
            font-weight: 600;
            font-family: 'SF Mono', Monaco, monospace;
            margin-bottom: 2px;
        }

        .key-metric .change {
            font-size: 0.8rem;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .key-metric .change.positive { color: #4ecdc4; }
        .key-metric .change.negative { color: #ff6b6b; }
        .key-metric .change.neutral { color: var(--text-secondary); }

        .key-metric.rate .value { color: var(--accent-cyan); }
        .key-metric.spread .value { color: var(--accent-yellow); }
        .key-metric.balance .value { color: var(--accent-teal); }

        /* Improved Alert Items */
        .alert-item {
            font-size: 0.85rem;
            padding: 8px 0;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .alert-item .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 6px;
            flex-shrink: 0;
        }

        .alert-box.critical .status-dot { background: #ff4444; }
        .alert-box.warning .status-dot { background: #ffaa00; }
        .alert-box.info .status-dot { background: #00aaff; }

        .alert-item .alert-content { flex: 1; }

        .alert-item strong {
            color: var(--accent-cyan);
        }

        /* Tablet styles */
        @media (max-width: 768px) {
            .container { padding: 12px; }
            header h1 { font-size: 1.4rem; }
            header .meta { font-size: 0.8rem; }
            .key-metrics-panel {
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                padding: 10px;
            }
            .key-metric { padding: 10px 6px; }
            .key-metric .label { font-size: 0.65rem; }
            .key-metric .value { font-size: 1.1rem; }
            .key-metric .change { font-size: 0.7rem; }
            .alerts-panel { grid-template-columns: 1fr; gap: 10px; }
            .alert-box { padding: 12px; }
            .alert-count { font-size: 1.5rem; }
            .chart-container { padding: 10px; margin-bottom: 15px; }
            .section-title { font-size: 1.1rem; margin: 30px 0 15px; }
            .table-container { padding: 10px; }
            table { font-size: 0.8rem; }
            th, td { padding: 8px 6px; }
        }

        /* Phone styles */
        @media (max-width: 480px) {
            .container { padding: 8px; }
            header { padding: 15px 0; margin-bottom: 15px; }
            header h1 { font-size: 1.2rem; }
            header .meta { font-size: 0.75rem; line-height: 1.4; }
            .key-metrics-panel {
                grid-template-columns: repeat(4, 1fr);
                gap: 6px;
                padding: 8px;
                margin-bottom: 15px;
            }
            .key-metric { padding: 8px 4px; border-radius: 6px; }
            .key-metric .label { font-size: 0.6rem; margin-bottom: 2px; }
            .key-metric .value { font-size: 0.95rem; }
            .key-metric .change { font-size: 0.6rem; }
            .alerts-panel { gap: 8px; margin-bottom: 20px; }
            .alert-box { padding: 10px; }
            .alert-box h3 { font-size: 0.75rem; margin-bottom: 5px; }
            .alert-count { font-size: 1.3rem; margin-bottom: 5px; }
            .alert-item { font-size: 0.75rem; padding: 6px 0; }
            .chart-container {
                padding: 10px;
                margin-bottom: 25px;  /* More spacing between charts */
                border-radius: 6px;
            }
            .section-title { font-size: 1rem; margin: 25px 0 12px; }
            .table-container {
                padding: 8px;
                border-radius: 6px;
                -webkit-overflow-scrolling: touch;
            }
            .table-container h3 { font-size: 0.9rem; margin-bottom: 10px; }
            table { font-size: 0.75rem; }
            th, td { padding: 6px 4px; white-space: nowrap; }
            th { font-size: 0.7rem; }
            footer { margin-top: 30px; padding: 15px 0; font-size: 0.75rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Wayne's Macro Dashboard</h1>
            <div class="meta" id="header-meta">Loading...</div>
        </header>

        <div id="key-metrics-section"></div>
        <div id="alerts-section"></div>
        <div id="charts-section"><div class="loading">Loading charts...</div></div>
        <h2 class="section-title">Data Tables</h2>
        <div id="tables-section"><div class="loading">Loading tables...</div></div>

        <footer>
            Wayne's Macro Dashboard 路
            <a href="https://opensource.org/licenses/MIT">MIT</a> 路
            <a href="https://github.com/realwaynesun/fed_monitor">GitHub</a>
        </footer>
    </div>

    <script>
        // Color palette - distinct colors for readability
        const COLORS = [
            '#00D4FF', '#FF6B6B', '#4ECDC4', '#FFE66D',
            '#95E1D3', '#F38181', '#AA96DA', '#FCBAD3'
        ];

        // Short labels for cleaner legends
        const SHORT_LABELS = {
            'Fed Funds Target Range - Lower': 'Target Lower',
            'Fed Funds Target Range - Upper': 'Target Upper',
            'Effective Federal Funds Rate': 'EFFR',
            'Interest Rate on Reserve Balances': 'IORB',
            'ON RRP Offering Rate': 'RRP Offer',
            'Discount Window Primary Credit Rate': 'Discount Window',
            'Standing Repo Facility Rate': 'SRF Rate',
            'Secured Overnight Financing Rate': 'SOFR',
            'Tri-Party General Collateral Rate': 'TGCR',
            'Overnight Bank Funding Rate': 'OBFR',
            'Reserve Balances with FRBs': 'Reserves',
            'Treasury General Account': 'TGA',
            'Currency in Circulation (H.4.1 Week Avg)': 'Currency',
            'Fed Total Assets': 'Fed Assets',
            'SOMA Securities Held Outright (Total)': 'SOMA Total',
            'SOMA U.S. Treasury Securities': 'SOMA Treasuries',
            'SOMA U.S. Treasury Bills': 'SOMA Bills',
            'SOMA UST Notes & Bonds (Nominal)': 'SOMA Coupons',
            'SOMA Mortgage-Backed Securities': 'SOMA MBS',
            'Discount Window Primary Credit Outstanding': 'Discount Window',
            'Central Bank Liquidity Swaps': 'CB Swaps',
            'Foreign Official Repo (Treasury)': 'Foreign Repo',
            'Chicago Fed National Financial Conditions Index': 'NFCI',
            'St. Louis Fed Financial Stress Index': 'STLFSI',
            'Kansas City Fed Financial Stress Index': 'KCFSI',
            'US High Yield OAS': 'HY OAS',
            'US Investment Grade OAS': 'IG OAS',
            'CBOE Volatility Index (VIX)': 'VIX',
            '3-Month Treasury Yield': '3M Yield',
            '2-Year Treasury Yield': '2Y Yield',
            '10-Year Treasury Yield': '10Y Yield',
            '10Y-3M Treasury Curve (bps)': '10Y-3M Curve',
            'ON RRP Usage': 'RRP Usage',
            'Overnight Repos (Treasury) - Amount': 'Repo Ops',
            'EFFR - IORB Spread': 'EFFR-IORB',
            'SOFR - EFFR Spread': 'SOFR-EFFR',
            'SOFR - ON RRP Offering Spread': 'SOFR-RRP',
            'EFFR vs Target Midpoint': 'EFFR vs Mid',
            'Money-Market Tightness Index (vs IORB)': 'MM Tightness',
            'EFFR Tail Range (99-1)': 'EFFR Tail',
            'OBFR Tail Range (99-1)': 'OBFR Tail',
            'SOFR Tail Range (99-1)': 'SOFR Tail',
            'TGCR Tail Range (99-1)': 'TGCR Tail',
            'EFFR Underlying Volume': 'EFFR Vol',
            'OBFR Underlying Volume': 'OBFR Vol',
            'SOFR Underlying Volume': 'SOFR Vol',
            'TGCR Underlying Volume': 'TGCR Vol',
            'Reserves as % of Bank Assets': 'Reserves/Assets',
            'RRP Share of (Reserves + RRP)': 'RRP Share',
            'RRP / Reserves Ratio': 'RRP/Reserves',
            'Net Liquidity (Billions)': 'Net Liquidity',
            'Market Net Liquidity Proxy': 'Market Liquidity'
        };

        // Line styles for visual hierarchy
        const LINE_STYLES = {
            // Dashed for target bounds (reference lines)
            'Target Lower': { dash: 'dash', width: 1.5 },
            'Target Upper': { dash: 'dash', width: 1.5 },
            'Discount Window': { dash: 'dot', width: 1.5 },
            // Thicker for key rates
            'EFFR': { dash: 'solid', width: 3 },
            'IORB': { dash: 'solid', width: 2.5 },
            'SOFR': { dash: 'solid', width: 2.5 },
            // Default
            'default': { dash: 'solid', width: 2 }
        };

        // Responsive breakpoints
        function getScreenType() {
            const width = window.innerWidth;
            if (width <= 480) return 'phone';
            if (width <= 768) return 'tablet';
            return 'desktop';
        }

        // Get responsive layout settings
        function getResponsiveLayout(baseHeight) {
            const screenType = getScreenType();

            const configs = {
                phone: {
                    height: Math.min(baseHeight, 280),  // Taller charts
                    margin: { t: 35, r: 10, b: 30, l: 45 },  // Less bottom margin, more left for y-axis
                    font: { size: 9 },
                    xaxis: { nticks: 4, tickfont: { size: 8 } },
                    yaxis: { tickfont: { size: 8 }, title: '' },
                    legend: { visible: false },  // Hide legend on phone - use hover instead
                    titleFont: { size: 11 }
                },
                tablet: {
                    height: Math.min(baseHeight, 280),
                    margin: { t: 40, r: 15, b: 75, l: 50 },
                    font: { size: 10 },
                    xaxis: { nticks: 6, tickfont: { size: 9 } },
                    yaxis: { tickfont: { size: 9 } },
                    legend: {
                        orientation: 'h',
                        yanchor: 'top',
                        y: -0.18,
                        xanchor: 'center',
                        x: 0.5,
                        font: { size: 8 },
                        bgcolor: 'rgba(0,0,0,0)'
                    },
                    titleFont: { size: 12 }
                },
                desktop: {
                    height: baseHeight,
                    margin: { t: 50, r: 20, b: 80, l: 60 },
                    font: { size: 11 },
                    xaxis: { nticks: 10, tickfont: { size: 10 } },
                    yaxis: { tickfont: { size: 10 } },
                    legend: {
                        orientation: 'h',
                        yanchor: 'top',
                        y: -0.15,
                        xanchor: 'center',
                        x: 0.5,
                        font: { size: 10 },
                        bgcolor: 'rgba(0,0,0,0)'
                    },
                    titleFont: { size: 14 }
                }
            };

            return configs[screenType];
        }

        // Plotly dark theme layout (base)
        const LAYOUT_BASE = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: '#fafafa', family: '-apple-system, sans-serif', size: 11 },
            xaxis: {
                gridcolor: '#333',
                linecolor: '#333',
                tickformat: '%b %y'
            },
            yaxis: {
                gridcolor: '#333',
                linecolor: '#333'
            },
            hovermode: 'x unified',
            hoverlabel: {
                bgcolor: '#1a1d24',
                bordercolor: '#333',
                font: { color: '#fafafa', size: 10 }
            },
            legend: {
                orientation: 'h',
                yanchor: 'top',
                y: -0.15,
                xanchor: 'center',
                x: 0.5,
                bgcolor: 'rgba(0,0,0,0)',
                font: { size: 10 }
            },
            margin: { t: 50, r: 20, b: 80, l: 60 }
        };

        // Format numbers for display
        function formatValue(value, unit) {
            if (value === null || value === undefined) return 'N/A';
            if (unit === 'usd_millions') {
                if (Math.abs(value) >= 1000000) return (value / 1000000).toFixed(1) + 'T';
                if (Math.abs(value) >= 1000) return (value / 1000).toFixed(0) + 'B';
                return value.toFixed(0) + 'M';
            }
            if (unit === 'usd_billions') {
                if (Math.abs(value) >= 1000) return (value / 1000).toFixed(1) + 'T';
                return value.toFixed(1) + 'B';
            }
            if (unit === 'percent' || unit === 'bps') return value.toFixed(2);
            if (unit === 'ratio') return value.toFixed(3);
            return value.toFixed(2);
        }

        function formatChange(value) {
            if (value === null || value === undefined) return '';
            const sign = value > 0 ? '+' : '';
            return sign + value.toFixed(2);
        }

        // Render key metrics summary panel
        function renderKeyMetrics(keyMetrics) {
            const section = document.getElementById('key-metrics-section');
            if (!keyMetrics || keyMetrics.length === 0) {
                section.innerHTML = '';
                return;
            }

            let html = '<div class="key-metrics-panel">';
            keyMetrics.forEach(m => {
                const changeClass = m.d1 > 0 ? 'positive' : (m.d1 < 0 ? 'negative' : 'neutral');
                const changeStr = m.d1 !== null ? formatChange(m.d1) : '--';

                html += `<div class="key-metric ${m.category}">
                    <div class="label">${m.label}</div>
                    <div class="value">${formatValue(m.value, m.unit)}</div>
                    <div class="change ${changeClass}">${changeStr}</div>
                </div>`;
            });
            html += '</div>';
            section.innerHTML = html;
        }

        // Render alerts with status dots
        function renderAlerts(alerts) {
            const section = document.getElementById('alerts-section');
            const { critical, warning, info } = alerts;

            const renderAlertItems = (items) => items.map(a =>
                `<div class="alert-item">
                    <span class="status-dot"></span>
                    <div class="alert-content"><strong>${a.key}</strong>: ${a.note}</div>
                </div>`
            ).join('');

            let html = '<div class="alerts-panel">';

            // Critical
            html += `<div class="alert-box critical">
                <h3>Critical</h3>
                <div class="alert-count">${critical.length}</div>
                ${renderAlertItems(critical)}
            </div>`;

            // Warning
            html += `<div class="alert-box warning">
                <h3>Warning</h3>
                <div class="alert-count">${warning.length}</div>
                ${renderAlertItems(warning)}
            </div>`;

            // Info
            html += `<div class="alert-box info">
                <h3>Info</h3>
                <div class="alert-count">${info.length}</div>
                ${renderAlertItems(info)}
            </div>`;

            html += '</div>';
            section.innerHTML = html;
        }

        // Render a single chart
        function renderChart(container, chartData, index) {
            const div = document.createElement('div');
            div.className = 'chart-container';
            div.id = `chart-${index}`;
            container.appendChild(div);

            // Get responsive settings
            const responsive = getResponsiveLayout(chartData.height || 400);
            const screenType = getScreenType();

            const traces = chartData.series.map((s, i) => {
                // Use short label if available
                const shortLabel = SHORT_LABELS[s.label] || s.label;

                // Get line style for visual hierarchy
                const lineStyle = LINE_STYLES[shortLabel] || LINE_STYLES['default'];

                // Adjust line width for mobile
                const lineWidth = screenType === 'phone'
                    ? Math.max(1, lineStyle.width - 0.5)
                    : lineStyle.width;

                const trace = {
                    x: s.dates,
                    y: s.values,
                    name: shortLabel,
                    type: 'scatter',
                    mode: 'lines',  // No markers - cleaner look
                    line: {
                        color: COLORS[i % COLORS.length],
                        width: lineWidth,
                        dash: lineStyle.dash
                    },
                    hovertemplate: `${shortLabel}: %{y:.4f}<extra></extra>`
                };

                if (chartData.type === 'area') {
                    trace.fill = 'tozeroy';
                    trace.fillcolor = COLORS[i % COLORS.length] + '4D'; // 30% opacity
                }

                return trace;
            });

            // Build responsive layout
            const layout = {
                ...LAYOUT_BASE,
                title: { text: chartData.title, font: { size: responsive.titleFont.size } },
                height: responsive.height,
                margin: responsive.margin,
                font: { ...LAYOUT_BASE.font, size: responsive.font.size },
                xaxis: {
                    ...LAYOUT_BASE.xaxis,
                    nticks: responsive.xaxis.nticks,
                    tickfont: responsive.xaxis.tickfont
                },
                yaxis: {
                    ...LAYOUT_BASE.yaxis,
                    title: screenType === 'phone' ? '' : chartData.y_label,
                    tickfont: responsive.yaxis.tickfont
                }
            };

            // Handle legend visibility
            if (responsive.legend.visible === false) {
                layout.showlegend = false;
            } else {
                layout.legend = responsive.legend;
            }

            // Add reference line if specified
            if (chartData.reference_line !== null) {
                layout.shapes = [{
                    type: 'line',
                    x0: 0, x1: 1, xref: 'paper',
                    y0: chartData.reference_line, y1: chartData.reference_line,
                    line: { color: '#666', width: 1, dash: 'dash' }
                }];
            }

            // Add current value annotations (show latest value for each series)
            // Only on desktop/tablet, and only for first 3 series to avoid clutter
            if (screenType !== 'phone' && chartData.series.length <= 4) {
                layout.annotations = chartData.series.slice(0, 3).map((s, i) => {
                    const lastIdx = s.values.length - 1;
                    const lastVal = s.values[lastIdx];
                    const shortLabel = SHORT_LABELS[s.label] || s.label;
                    if (lastVal === null || lastVal === undefined) return null;

                    return {
                        x: 1,
                        y: lastVal,
                        xref: 'paper',
                        yref: 'y',
                        text: `${lastVal.toFixed(2)}`,
                        showarrow: false,
                        font: { size: 9, color: COLORS[i % COLORS.length] },
                        xanchor: 'left',
                        bgcolor: 'rgba(26,29,36,0.8)',
                        borderpad: 2,
                    };
                }).filter(a => a !== null);
            }

            Plotly.newPlot(div.id, traces, layout, { responsive: true, displayModeBar: false });
        }

        // Render all charts
        function renderCharts(charts) {
            const section = document.getElementById('charts-section');
            section.innerHTML = '';

            charts.forEach((chart, i) => {
                renderChart(section, chart, i);
            });
        }

        // Render tables
        function renderTables(tables) {
            const section = document.getElementById('tables-section');
            section.innerHTML = '';

            tables.forEach(table => {
                const div = document.createElement('div');
                div.className = 'table-container';

                let html = `<h3>${table.title}</h3>`;
                html += '<table><thead><tr><th>Metric</th><th>Date</th><th>Value</th>';

                // Add column headers for changes/rolling
                table.columns.filter(c => c !== 'value').forEach(col => {
                    html += `<th>${col.toUpperCase()}</th>`;
                });
                html += '</tr></thead><tbody>';

                table.rows.forEach(row => {
                    html += '<tr>';
                    html += `<td>${row.label}</td>`;
                    html += `<td>${row.date}</td>`;
                    html += `<td>${formatValue(row.value, row.unit)}</td>`;

                    table.columns.filter(c => c !== 'value').forEach(col => {
                        const val = row[col];
                        const formatted = formatChange(val);
                        const cls = val > 0 ? 'positive' : (val < 0 ? 'negative' : '');
                        html += `<td class="${cls}">${formatted}</td>`;
                    });

                    html += '</tr>';
                });

                html += '</tbody></table>';
                div.innerHTML = html;
                section.appendChild(div);
            });
        }

        // Load and render data
        async function loadDashboard() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();

                // Update header
                const meta = document.getElementById('header-meta');
                const generated = new Date(data.generated_at).toLocaleString();
                meta.textContent = `Data: ${data.date_range.start} to ${data.date_range.end} 路 Generated: ${generated} 路 Config v${data.config_version}`;

                // Cache chart data for resize re-rendering
                cachedChartData = data.charts;

                // Render sections
                renderKeyMetrics(data.key_metrics);
                renderAlerts(data.alerts);
                renderCharts(data.charts);
                renderTables(data.tables);

            } catch (error) {
                console.error('Failed to load data:', error);
                document.getElementById('charts-section').innerHTML =
                    `<div class="loading">Error loading data: ${error.message}</div>`;
            }
        }

        // Store chart data for re-rendering
        let cachedChartData = null;

        // Re-render charts on resize (debounced)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (cachedChartData) {
                    renderCharts(cachedChartData);
                }
            }, 250);
        });

        // Initialize
        loadDashboard();
    </script>
</body>
</html>
